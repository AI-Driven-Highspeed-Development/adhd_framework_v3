---
project: "Instruction System Optimization"
current_phase: 0
phase_name: "Code Quality + Skill Discovery"
status: TODO
last_updated: "2026-02-09"
scope_revised: "2026-02-09"
---

# 80 - Implementation Plan

> Part of [Instruction System Optimization Blueprint](./00_index.md)

<!-- 
âš ï¸  CODE EXAMPLES & FOLDER STRUCTURES WARNING âš ï¸
Examples in this document are ILLUSTRATIVE, not PRESCRIPTIVE.
The implementation agent (HyperArch) will determine actual paths and syntax.
-->

---

## ðŸ“Š Scope Revision (2026-02-09)

| Change | Reason |
|--------|--------|
| P0 = Code Quality Fixes + Skill Discovery Index | Primary user needs |
| P1 = VS Code Platform Profiles | Good to have, not immediate |
| CUT: Line limits, token budgets, audit tool | Overkill for current needs |

---

## ðŸ“Š Status Legend

| Icon | Status | Meaning |
|------|--------|---------|
| â³ | `[TODO]` | Not started |
| ðŸ”„ | `[WIP]` | In progress |
| âœ… | `[DONE]` | Complete |
| ðŸš§ | `[BLOCKED:reason]` | Stuck (kebab-case reason) |
| ðŸš« | `[CUT]` | Removed from scope |

---

## ðŸ¦´ Phase 0: Code Quality + Skill Discovery (P0)

**Goal:** *"Clean up agent files and generate SKILLS_INDEX.md"*

**Duration:** 1 week (HARD LIMIT)

### Exit Gate

- [ ] Code quality fixes applied to all target agents
- [ ] `adhd instruction sync` generates `SKILLS_INDEX.md` in `data/compiled/`

---

### P0.A: Code Quality Fixes

| Status | Task | Target | Difficulty |
|--------|------|--------|------------|
| â³ | Move "Document Ownership Routing Table" to `orch-routing` skill | HyperOrch | `[KNOWN]` |
| â³ | Move "Artifact Locations" to `testing` skill | HyperRed | `[KNOWN]` |
| â³ | Condense Adversarial Awareness + Discovery Checklist | HyperArch | `[KNOWN]` |
| â³ | Move/condense "Solution Selection" decision tree | HyperDream | `[KNOWN]` |
| â³ | Remove Output Format JSON example (already in instruction file) | HyperSan | `[KNOWN]` |
| â³ | Remove duplicate Edit Locations rule | HyperAgentSmith | `[KNOWN]` |
| â³ | Add `agent` field to all prompts | All `.prompt.md` | `[KNOWN]` |
| â³ | Add `agents` field (subagent allowlist) | HyperOrch YAML | `[KNOWN]` |
| â³ | Add `model` field | HyperRed YAML | `[KNOWN]` |

---

### P0.B: Skill Discovery Index

| Status | Task | Module | Difficulty |
|--------|------|--------|------------|
| â³ | Create `skills_indexer.py` to scan `.github/skills/*/SKILL.md` | `instruction_core/` | `[KNOWN]` |
| â³ | Parse YAML frontmatter (name, description) | `instruction_core/` | `[KNOWN]` |
| â³ | Extract "When NOT to Use" section from body | `instruction_core/` | `[KNOWN]` |
| â³ | Generate `SKILLS_INDEX.md` during `instruction sync` | `instruction_core/` | `[KNOWN]` |

### P0 Hard Limits

- âŒ No `[RESEARCH]` or `[EXPERIMENTAL]` items
- âœ… All tasks are `[KNOWN]`
- âœ… Code quality = manual edits (no new code)
- âœ… Skill discovery = 4 implementation tasks

### Target Folder Structure (P0)

```
instruction_core/
â”œâ”€â”€ instruction_controller.py     (MODIFIED - add skill index step)
â”œâ”€â”€ indexers/
â”‚   â””â”€â”€ skills_indexer.py         (NEW)
â””â”€â”€ data/
    â””â”€â”€ compiled/
        â””â”€â”€ SKILLS_INDEX.md       (GENERATED)
```

### SKILLS_INDEX.md Example Output

```markdown
# Skills Index

> Auto-generated by `adhd instruction sync` on 2026-02-09

| Skill | Description | When NOT to Use |
|-------|-------------|-----------------|
| day-dream | Vision and planning workflows | Implementation tasks, bug fixes |
| expedition | Framework export workflows | Internal-only modules |
| testing | Test folder conventions | Production code changes |
```

### Verification (Manual)

**Code Quality Fixes:**

| What to Verify | Expected Result |
|----------------|-----------------|
| HyperOrch references `orch-routing` skill | Routing table not duplicated |
| HyperRed references `testing` skill | Artifact locations not duplicated |
| HyperArch condensed | Adversarial + Discovery < 10 lines |
| All `.prompt.md` YAML | `agent` field present |
| HyperOrch YAML | `agents` field present |

**Skill Discovery:**

| What to Try | Expected Result |
|-------------|-----------------|
| Run `adhd instruction sync` | SKILLS_INDEX.md generated in `data/compiled/` |
| Check index contains all skills | All `.github/skills/*/SKILL.md` represented |
| Verify "When NOT to Use" column | Non-empty for skills with that section |

### P0 Completion Checklist

- [ ] Exit gate commands run successfully
- [ ] Code quality tasks marked âœ…
- [ ] Skill discovery tasks marked âœ…
- [ ] Manual verification steps pass

---

## ðŸ—ï¸ Phase 1: VS Code Platform Profiles (P1)

**Goal:** *"Split schema into core + optional vscode profile for export scenarios"*

**Duration:** 1 week (after P0 validated)

**Priority:** Good to have, not immediate.

### Exit Gate

- [ ] VS Code profile can be toggled on/off during compilation
- [ ] `--profile generic` produces output without VS Code-specific fields

### Tasks

| Status | Task | Module | Difficulty |
|--------|------|--------|------------|
| â³ | Design core vs vscode field separation | `instruction_core/` | `[KNOWN]` |
| â³ | Split schema into `core.schema.json` + `vscode.profile.json` | `instruction_core/` | `[KNOWN]` |
| â³ | Implement profile loader and merger | `instruction_core/` | `[KNOWN]` |
| â³ | Add `--profile` flag to instruction CLI | `instruction_core/` | `[KNOWN]` |

### Target Folder Structure (P1)

```
instruction_core/
â”œâ”€â”€ profiles/
â”‚   â””â”€â”€ profile_loader.py         (NEW)
â””â”€â”€ data/
    â””â”€â”€ schemas/
        â”œâ”€â”€ core.schema.json      (NEW)
        â””â”€â”€ profiles/
            â””â”€â”€ vscode.profile.json (NEW)
```

### Verification (Manual)

| What to Try | Expected Result |
|-------------|-----------------|
| Run sync with `--profile vscode` | VS Code-specific fields included |
| Run sync with `--profile generic` | VS Code fields omitted |
| Run sync with no profile flag | Default behavior (vscode) |

### P1 Completion Checklist

- [ ] Exit gate command runs successfully
- [ ] Manual verification steps pass

---

## ðŸ“¡ Phase 2+: Future Considerations

**Status:** Not planned (features cut from scope)

These features were evaluated but cut from this blueprint:

| Feature | Decision Date | Reason |
|---------|--------------|--------|
| Line Limit Enforcement | 2026-02-09 | Overkill for current needs |
| Token Budget Annotations | 2026-02-09 | Overkill for current needs |
| Instruction Audit Tool | 2026-02-09 | Good but not immediate priority |
| Flow Fragment Versioning | 2026-02-09 | Premature optimization |
| Behavioral Compliance Testing | 2026-02-09 | Research-grade, no immediate need |
| Runtime Content Deduplication | 2026-02-09 | Orchestration layer not mature |

**Note:** These may be reconsidered in a future blueprint if needs change.

---

## âš ï¸ Error Handling Implementation

### Error Types

| Error Class | When Raised | Recovery |
|-------------|-------------|----------|
| `SkillMissingMetadata` | SKILL.md lacks required frontmatter | fail sync with clear error |
| `SkillParseError` | SKILL.md malformed | warn, skip skill |
| `ProfileNotFound` | Unknown profile specified (P1) | fail |

### Logging Requirements

| Level | When | Example |
|-------|------|---------|
| ERROR | Missing required metadata | `"SKILL.md missing 'name' in frontmatter"` |
| WARNING | Could not extract 'When NOT to Use' | `"Skill 'testing' has no 'When NOT to Use' section"` |
| INFO | Index generated | `"SKILLS_INDEX.md generated with 9 skills"` |

---

## ðŸ“ Decisions Log

| Date | Decision | Rationale | Decided By |
|------|----------|-----------|------------|
| 2026-02-09 | Scope revised to 2 features | User feedback: line limits/token budgets overkill | User + HyperDream |
| 2026-02-09 | P0 = Skill Discovery Index | Primary user need | User |
| 2026-02-09 | P1 = VS Code Profiles | Good to have, not immediate | User |
| 2026-02-09 | Cut: Instruction Audit Tool | Good but not immediate priority | User |

---

## âœ‚ï¸ Cut List

| Feature | Cut Date | Reason |
|---------|----------|--------|
| Line Limit Enforcement | 2026-02-09 | Overkill for current needs |
| Token Budget Annotations | 2026-02-09 | Overkill for current needs |
| Instruction Audit Tool | 2026-02-09 | Good but not immediate priority |
| Flow Fragment Versioning | 2026-02-09 | Premature optimization |
| Behavioral Compliance Testing | 2026-02-09 | Research-grade |
| Runtime Content Deduplication | 2026-02-09 | Orchestration layer not mature |

---

## ðŸ”¬ Exploration Log

| Date | Topic | Status | Synthesized To |
|------|-------|--------|----------------|
| - | - | - | - |

---

**â† Back to:** [Index](./00_index.md)

<!--
NOTES:
1. Update YAML frontmatter when changing phases
2. Status flow: â³ â†’ ðŸ”„ â†’ âœ…
3. P0 tasks must be completed before starting P1
4. Deferred features have explicit triggers
-->
